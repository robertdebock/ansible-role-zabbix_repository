---
# tasks file for zabbix_repository
- name: install (dnf/yum)
  package:
    name: "{{ zabbix_repository_package }}"
    state: present
  register: zabbix_repository_install_dnf_yum
  until: zabbix_repository_install_dnf_yum is succeeded
  retries: 3
  when:
    - ansible_pkg_mgr == "dnf" or
      ansible_pkg_mgr == "yum"

- name: install (apt)
  apt:
    deb: "{{ zabbix_repository_package }}"
  register: zabbix_repository_install_apt
  until: zabbix_repository_install_apt is succeeded
  retries: 3
  when:
    - ansible_pkg_mgr == "apt"
  notify:
    - update cache

- name: fail when both yum/dnf and apt are skipped
  fail:
    msg: "This system does not support yum, dnf or apt."
  when:
    - zabbix_repository_install_dnf_yum is skipped
    - zabbix_repository_install_apt is skipped

- name: create /etc/zabbix
  file:
    path: /etc/zabbix
    state: directory

- name: flush handlers
  meta: flush_handlers

---
# tasks file for zabbix_repository
- name: include assert.yml
  include_tasks: assert.yml

- name: install (dnf/yum)
  package:
    name: "{{ zabbix_repository_package }}"
    state: present
  when:
    - ansible_pkg_mgr == "dnf" or
      ansible_pkg_mgr == "yum"

- name: install (apt)
  apt:
    deb: "{{ zabbix_repository_package }}"
  when:
    - ansible_pkg_mgr == "apt"
  notify:
    - update cache

- name: install (zypper}
  zypper:
    name: "{{ zabbix_repository_package }}"
    state: present
    disable_gpg_check: yes
  when:
    - ansible_pkg_mgr == "zypper"

- name: fail when yum/dnf, apt and zypper are skipped
  fail:
    msg: "This system does not support yum, dnf or apt."
  when:
    - zabbix_repository_install_dnf_yum is skipped
    - zabbix_repository_install_apt is skipped
    - zabbix_repository_install_zypper is skipped

- name: create /etc/zabbix
  file:
    path: /etc/zabbix
    state: directory

- name: flush handlers
  meta: flush_handlers
